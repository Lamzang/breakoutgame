<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="css/style.css" />
    <title>breakoutgame</title>
  </head>
  <body>
    <div id="root"></div>
  </body>
  <script src="https://unpkg.com/react@17.0.2/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@17.0.2/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/prop-types@15.7.2/prop-types.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script type="text/babel">
    const blockWidth = 100;
    const blockHeight = 20;
    const boardWidth = 560;
    const userWidth = 100;
    let userCurrentPosition = [230, 10];
    let ballCurrentPosition = [270, 40];
    let memory = [230];

    let once = 0;

    function Score() {
      return <h1>0</h1>;
    }

    function User() {
      return (
        <div
          id="userID"
          style={{
            position: "absolute",
            width: "100px",
            height: "20px",
            backgroundColor: "blueviolet",
            left: userCurrentPosition[0],
            bottom: "10px",
          }}
        ></div>
      );
    }

    function Ball() {
      return (
        <div
          id="ballID"
          style={{
            position: "absolute",
            width: "20px",
            height: "20px",
            borderRadius: "10px",
            backgroundColor: "red",
            left: "270px",
            bottom: "40px",
          }}
        ></div>
      );
    }

    function MovingDiv() {
      const handleDragStart = (event) => {
        console.log(event);
        /*https://developer.mozilla.org/ko/docs/Web/API/HTML_Drag_and_Drop_API/Drag_operations#%EB%93%9C%EB%9E%98%EA%B7%B8_%ED%94%BC%EB%93%9C%EB%B0%B1_%EC%9D%B4%EB%AF%B8%EC%A7%80_%EC%84%A4%EC%A0%95*/
      };
      const handleDrag = (event) => {
        memory.push(event.clientX);
        userCurrentPosition[0] = memory[memory.length - 2];
        ReactDOM.render(<App />, root);
      };
      const handleDragEnd = (event) => {
        memory.pop();
        memory.splice(0, memory.length - 1);
      };
      return (
        <div
          style={{
            position: "absolute",
            width: "100px",
            height: "30px",
            border: "solid 1px black",
            left: userCurrentPosition[0],
            background: "white",
            cursor: "grab",
            marginTop: "330px",
          }}
          onDragStart={handleDragStart}
          onDrag={handleDrag}
          onDragEnd={handleDragEnd}
          draggable="true"
        ></div>
      );
    }

    function PlayGround() {
      return (
        <div
          style={{
            position: "absolute",
            width: "560px",
            height: "300px",
            border: "solid 1px black",
            marginTop: "0px",
          }}
          id="playground"
        >
          <User />
          <Ball />
        </div>
      );
    }

    function App() {
      return (
        <div id="app">
          <Score />
          <PlayGround />
          <MovingDiv />
        </div>
      );
    }
    const root = document.querySelector("#root");
    ReactDOM.render(<App />, root);

    //end of basic scaffold

    //start of functions
    //blocks
    class Block {
      constructor(x, y) {
        this.topRight = [x + blockWidth, y + blockHeight];
        this.topLeft = [x, y + blockHeight];
        this.bottomLeft = [x, y];
        this.bottomRight = [x + blockWidth, y];
      }
    }

    const blockList = [
      new Block(10, 270),
      new Block(120, 270),
      new Block(230, 270),
      new Block(340, 270),
      new Block(450, 270),
      new Block(10, 240),
      new Block(120, 240),
      new Block(230, 240),
      new Block(340, 240),
      new Block(450, 240),
      new Block(10, 210),
      new Block(120, 210),
      new Block(230, 210),
      new Block(340, 210),
      new Block(450, 210),
    ];

    function DrawBlockObject() {
      for (let i = 0; i < blockList.length; i++) {
        const block = document.createElement("div");
        const superObj = document.querySelector("#playground");
        block.classList.add("block");
        block.style.left = blockList[i].bottomLeft[0] + "px";
        block.style.bottom = blockList[i].bottomLeft[1] + "px";
        superObj.appendChild(block);
      }
    }

    DrawBlockObject();

    /**
    우선 React를 연습하기 위해 하는 것일텐데
    정작 React의 기능을 거의 사용못함
    따라서 keydown에 의해 움직이는 것이 아니라 다른 component에 의해 움직이는
    새로운 방식의 breakout game을 만들어서 React를 적용해보자
    우선ReactDOM을 무분별하게 사용하는 것은 진짜 아닌듯
    심지어 기존에는 css를 사용해서 움직였는데, 지금은 굳이 ReactDOM을 사용해서
    메모리가 더 심해짐
    **/
  </script>
</html>
